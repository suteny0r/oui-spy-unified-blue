[env:seeed_xiao_esp32s3]
platform = espressif32@^6.3.0
board = seeed_xiao_esp32s3
framework = arduino

; Build options
build_flags = 
    -DCORE_DEBUG_LEVEL=0
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    -DCONFIG_BT_NIMBLE_ENABLED=1
    -Isrc/raw

; Upload options
upload_speed = 921600
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; Libraries
lib_deps = 
    h2zero/NimBLE-Arduino@^1.4.0
    mathieucarbou/ESP Async WebServer@^3.0.6
    adafruit/Adafruit NeoPixel@^1.12.0
    bblanchon/ArduinoJson@^7.0.4

; Board configuration
board_build.arduino.memory_type = qio_opi
board_build.partitions = partitions.csv
board_build.filesystem = littlefs

; USB CDC configuration
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = qio

; Exclude raw source files and C6 entry point from compilation
src_filter = +<*> -<raw/> -<main_c6_flockyou.cpp>

; =============================================================================
; XIAO ESP32-C6 â€” Standalone Flock-You build
; =============================================================================
; BLE 5.3 + WiFi 6 single-mode firmware (no selector, no other modes).
; Requires pioarduino platform fork (arduino-esp32 3.x) and NimBLE 2.x.
; =============================================================================
[env:xiao_esp32c6_flockyou]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip
board = seeed_xiao_esp32c6
framework = arduino

; Override pioarduino's custom registry packages with standard PlatformIO ones
platform_packages =
    platformio/toolchain-riscv32-esp
    platformio/tool-esptoolpy

build_flags =
    -DCORE_DEBUG_LEVEL=0
    -DCONFIG_BT_NIMBLE_ENABLED=1
    -Isrc/raw
    ; C6 buzzer on GPIO2 (GPIO3 is antenna control on C6)
    -DBUZZER_PIN=2
    ; C6 built-in LED on GPIO15 (active LOW)
    -DFLOCKYOU_LED_PIN=15
    ; External NeoPixel on D1/GPIO1 (wire a WS2812 to pin D1)
    -DFLOCKYOU_NEOPIXEL=1

upload_speed = 921600
monitor_speed = 115200

lib_deps =
    h2zero/NimBLE-Arduino@^2.0.0
    https://github.com/mathieucarbou/ESPAsyncWebServer.git
    adafruit/Adafruit NeoPixel@^1.12.0
    bblanchon/ArduinoJson@^7.0.4

board_build.partitions = partitions_c6.csv
board_build.filesystem = spiffs

; Only build the C6 entry point + flockyou wrapper (excludes main.cpp and other modes)
src_filter = +<main_c6_flockyou.cpp> +<mode_flockyou.cpp> -<raw/>
